# Подготовить ветку jupyter-mess для kubeflow

Берём за основу ветку template с пустым репозиторием для блокнотов.
Единственное, что нужно изменить - убрать PyPI, смотреть только на `repo.sberned.ru`.

# Подготовить инструкцию

## getting started
- Запуск образа в kubeflow
- Ждём пока стартует vscode, около дополнительных 30 сек
- Клонируем jupyter-mess ветку template
- Прописать пакеты в pyproject.toml
- make env-create
- Создать блокнот
- Привязать к jupyter-серверу из виртуального окружения
- Выполнить команду в блокноте
- fullscreen в браузере для более простого UI

## Добавление пакета
- poetry add "package=version"

## Подключение к ProjectX
И здесь же, как прописываем секретные учётные  данные

## Обмен файлами с локальной машиной
File -> Open File -> Show local
File -> Save as -> Show local

## Терминал vscode
Открыть / Максимизировать / Скрыть

## Lazygit

# Избавиться от двойного копирования

расширений vscode, чтобы ускорить время старта. Сейчас около 30 сек лишних.

Первое копирование происходит в
`components/example-notebook-servers/base/s6/cont-init.d/01-copy-tmp-home`

Оно без перезатирания, нам это не подходит, поэтому ещё раз копируем в
`components/example-notebook-servers/codeserver/s6/cont-init.d/02-copy-vscode-extensions`

Нужно разбораться по исходникам, как vscode управляет файлами расширений,
может окажется достаточно копировать с затиранием
`~/.local/share/code-server/extensions/extensions.json`, а остальные будут
копироваться только в 1й раз.

# Установить пакеты emacs

Т.к. в kubeflow нет доступа в интернет, их придётся поставить на этапе
формирования образа и копировать в домашнюю директорию.

# Перенести этот репозиторий в bitbucket Домклик
Сейчас мешает то, что нельзя пушить коммиты со сторонними авторами. Нужно
убрать это ограничение и-таки перенести.

# Инструкция по сборке этого конкретного образа
Это просто, но не очевидно.
```bash
cd components/example-notebook-servers/codeserver
make -C ../base && make
```
И т.д, `docker tag`, `docker push`.

# Как тестировать локально образ c GPU
Как установить и сконфигурировать `nvidia-container-toolkit`
Как запускать образ, чтобы подцепилась GPU

# PR в исходный репозиторий kubeflow
Это уменьшит разницу между нашим образом и upstream-версией, что снизит бремя
доработки, т.к. ниже шанс ломающей правки в upstream, например когда они
переедут с Ubuntu 22 на 24. Кроме того в процессе PR мы можем получить
бесплатные ценные советы.

В идеале, в нашем образе должен остаться только poetry и необязательные пакеты
для комфорта, lazygit, emacs и т.п.

В этом случае, нам больше не потребуется этот репозиторий, мы просто
отнаследуемся от готового образа, от всей репы у нас останется только эта
папка.

И собирать образ можно будет по-простому через `docker build`.
